<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart System Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: #0D0D0D; 
            color: white; 
        }
        .test-button { 
            background: #9945FF; 
            color: white; 
            border: none; 
            padding: 15px 30px; 
            margin: 10px; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 16px; 
        }
        .test-button:hover { background: #7c3aed; }
        
        .cart-count { 
            background: red; 
            color: white; 
            border-radius: 50%; 
            width: 25px; 
            height: 25px; 
            display: none; 
            text-align: center; 
            line-height: 25px; 
            font-size: 14px; 
            position: absolute; 
            top: -5px; 
            right: -5px; 
        }
        
        .cart-button-container {
            position: relative;
            display: inline-block;
            margin: 20px 0;
        }
        
        #cartSidebar {
            position: fixed;
            right: -400px;
            top: 0;
            width: 400px;
            height: 100vh;
            background: #1a1a1a;
            border-left: 2px solid #9945FF;
            transition: right 0.3s;
            z-index: 1000;
            overflow-y: auto;
            padding: 20px;
        }
        #cartSidebar.active {
            right: 0;
        }
        #cartOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            display: none;
        }
        #cartOverlay.active {
            display: block;
        }
        
        .cart-item {
            border: 1px solid #333;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            background: #2a2a2a;
        }
        
        .quantity-btn {
            background: #9945FF;
            color: white;
            border: none;
            padding: 5px 10px;
            margin: 0 5px;
            border-radius: 3px;
            cursor: pointer;
        }
        
        .item-remove {
            background: #ff4444;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            float: right;
        }
        
        #console-output {
            background: #2a2a2a;
            padding: 15px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            border-radius: 8px;
            border: 1px solid #333;
        }
        
        .success { color: #4ade80; }
        .error { color: #ef4444; }
        .warn { color: #f59e0b; }
    </style>
</head>
<body>
    <h1>ðŸ›’ Cart System Test</h1>
    
    <div>
        <button class="test-button" onclick="testBasicAddToCart()">Test Basic Add to Cart</button>
        <button class="test-button" onclick="testMultipleProducts()">Test Multiple Products</button>
        <button class="test-button" onclick="testQuantityUpdate()">Test Quantity Update</button>
        
        <div class="cart-button-container">
            <button class="test-button" onclick="openCartSidebar()">Open Cart Sidebar</button>
            <span class="cart-count">0</span>
        </div>
        
        <button class="test-button" onclick="clearCart()">Clear Cart</button>
    </div>
    
    <div style="margin-top: 20px;">
        <h3>Function Status:</h3>
        <div id="function-status"></div>
    </div>
    
    <div style="margin-top: 20px;">
        <h3>Console Output:</h3>
        <div id="console-output"></div>
    </div>
    
    <!-- Cart Sidebar -->
    <div id="cartSidebar">
        <div class="cart-sidebar-wrapper">
            <div class="cart-sidebar-header">
                <h2>Shopping Cart</h2>
                <button onclick="closeCartSidebar()" style="float: right; background: none; border: none; font-size: 24px; cursor: pointer; color: white;">&times;</button>
            </div>
            <div id="cartItemsList"></div>
            <div id="cartEmpty" style="text-align: center; padding: 40px;">
                <p>Your cart is empty</p>
            </div>
            <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #333;">
                <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                    <span>Subtotal:</span>
                    <span id="cart-subtotal">$0.00</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                    <span>Tax:</span>
                    <span id="cart-tax">$0.00</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                    <span>Shipping:</span>
                    <span id="cart-shipping">$9.99</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin: 10px 0; font-weight: bold; font-size: 1.1rem;">
                    <span>Total:</span>
                    <span id="cart-total">$0.00</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Overlay -->
    <div id="cartOverlay"></div>
    
    <!-- Load the actual script -->
    <script src="script.js?v=30"></script>
    
    <script>
        // Console capture for debugging
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        const outputDiv = document.getElementById('console-output');
        
        function appendToOutput(message, type = 'log') {
            const color = type === 'error' ? '#ef4444' : (type === 'warn' ? '#f59e0b' : '#4ade80');
            const time = new Date().toLocaleTimeString();
            outputDiv.innerHTML += `<div style="color: ${color}; margin: 2px 0;">[${time}] ${message}</div>`;
            outputDiv.scrollTop = outputDiv.scrollHeight;
        }
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            appendToOutput(args.join(' '), 'log');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            appendToOutput(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            appendToOutput(args.join(' '), 'warn');
        };
        
        // Test functions
        function testBasicAddToCart() {
            console.log('=== Testing Basic Add to Cart ===');
            if (typeof window.addToCart === 'function') {
                window.addToCart('Test Product', 25.99, '10mg', 'images/tb-500.png');
            } else {
                console.error('addToCart function not available!');
            }
        }
        
        function testMultipleProducts() {
            console.log('=== Testing Multiple Products ===');
            if (typeof window.addToCart === 'function') {
                window.addToCart('BPC-157', 89.99, '5mg', 'images/tb-500.png');
                window.addToCart('TB-500', 94.99, '5mg', 'images/tb-500.png');
                window.addToCart('GHK-Cu', 129.99, '50mg', 'images/tb-500.png');
            } else {
                console.error('addToCart function not available!');
            }
        }
        
        function testQuantityUpdate() {
            console.log('=== Testing Quantity Updates ===');
            // Add same product twice to test quantity increase
            if (typeof window.addToCart === 'function') {
                window.addToCart('Duplicate Test', 50.00, '10mg', 'images/tb-500.png');
                window.addToCart('Duplicate Test', 50.00, '10mg', 'images/tb-500.png');
            } else {
                console.error('addToCart function not available!');
            }
        }
        
        function clearCart() {
            console.log('=== Clearing Cart ===');
            if (typeof window.cart !== 'undefined') {
                window.cart = [];
                if (typeof window.updateCartDisplay === 'function') {
                    window.updateCartDisplay();
                }
                console.log('Cart cleared');
            } else {
                console.error('Cart variable not available!');
            }
        }
        
        function updateFunctionStatus() {
            const statusDiv = document.getElementById('function-status');
            statusDiv.innerHTML = `
                <div>addToCart: <span class="${typeof window.addToCart === 'function' ? 'success' : 'error'}">${typeof window.addToCart}</span></div>
                <div>openCartSidebar: <span class="${typeof window.openCartSidebar === 'function' ? 'success' : 'error'}">${typeof window.openCartSidebar}</span></div>
                <div>updateCartDisplay: <span class="${typeof window.updateCartDisplay === 'function' ? 'success' : 'error'}">${typeof window.updateCartDisplay}</span></div>
                <div>cart array: <span class="${typeof window.cart !== 'undefined' ? 'success' : 'error'}">${typeof window.cart}</span></div>
                <div>cart length: <span class="success">${window.cart ? window.cart.length : 'N/A'}</span></div>
            `;
        }
        
        // Check functions on load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded - checking cart system');
            setTimeout(function() {
                updateFunctionStatus();
                console.log('=== Cart System Status ===');
                console.log('Available functions:', Object.keys(window).filter(k => k.includes('cart') || k.includes('Cart')));
            }, 1000);
        });
        
        // Update status every 2 seconds
        setInterval(updateFunctionStatus, 2000);
    </script>
</body>
</html>